"use strict";(self.webpackChunkcashwarden_web_ng=self.webpackChunkcashwarden_web_ng||[]).push([[817],{1817:(rt,v,r)=>{r.r(v),r.d(v,{TagModule:()=>at});var T=r(4815),c=r(655),t=r(4650),S=r(4968),C=r(9300),F=r(8372),x=r(7579),J=r(3085),Y=r(4913),N=r(3567),p=r(174),L=r(3353);const $=["container"];let Q=(()=>{class e{constructor(n,o){this.cogSrv=n,this.lazySrv=o,this.loading=!1,this.loaded=!1,this.notify$=new x.x,this.cog={theme:""}}get cog(){return this._cog}set cog(n){this._cog=this.cogSrv.merge("chart",{theme:"",libs:["https://gw.alipayobjects.com/os/lib/antv/g2/4.1.46/dist/g2.min.js","https://gw.alipayobjects.com/os/lib/antv/data-set/0.11.8/dist/data-set.js"]},n)}libLoad(){return this.loading?(this.loaded&&this.notify$.next(),this):(this.loading=!0,this.lazySrv.load(this.cog.libs).then(()=>{this.loaded=!0,this.notify$.next()}),this)}get notify(){return this.notify$.asObservable()}ngOnDestroy(){this.notify$.unsubscribe()}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(Y.Ri),t.LFG(N.Df))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),R=(()=>{class e{constructor(n,o,i,a,l){this.srv=n,this.el=o,this.ngZone=i,this.platform=a,this.cdr=l,this.repaint=!0,this.destroy$=new x.x,this.loaded=!1,this.delay=0,this.ready=new t.vpe,this.theme=n.cog.theme,this.srv.notify.pipe((0,J.R)(this.destroy$),(0,C.h)(()=>!this.loaded)).subscribe(()=>this.load())}get chart(){return this._chart}get winG2(){return window.G2}changeData(){}onInit(){}onChanges(n){}load(){this.ngZone.run(()=>{this.loaded=!0,this.cdr.detectChanges()}),setTimeout(()=>this.install(),this.delay)}ngOnInit(){!this.platform.isBrowser||(this.onInit(),this.winG2?this.load():this.srv.libLoad())}ngOnChanges(n){this.onChanges(n),(this.onlyChangeData?this.onlyChangeData(n):1===Object.keys(n).length&&n.data)?this.changeData():!this.chart||!this.repaint||this.ngZone.runOutsideAngular(()=>{this.destroyChart().install()})}destroyChart(){return this._chart&&this._chart.destroy(),this}ngOnDestroy(){this.resize$&&this.resize$.unsubscribe(),this.destroy$.next(),this.destroy$.complete(),this.destroyChart()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(Q),t.Y36(t.SBq),t.Y36(t.R0b),t.Y36(L.t4),t.Y36(t.sBO))},e.\u0275dir=t.lG2({type:e,viewQuery:function(n,o){if(1&n&&t.Gf($,7),2&n){let i;t.iGM(i=t.CRH())&&(o.node=i.first)}},inputs:{repaint:"repaint",delay:"delay",theme:"theme"},outputs:{ready:"ready"},features:[t.TTD]}),(0,c.gn)([(0,p.yF)()],e.prototype,"repaint",void 0),(0,c.gn)([(0,p.Rn)()],e.prototype,"delay",void 0),(0,c.gn)([(0,p.EA)()],e.prototype,"load",null),(0,c.gn)([(0,p.EA)()],e.prototype,"destroyChart",null),e})();var h=r(6895),z=r(545);function B(e,s){1&e&&t._UZ(0,"nz-skeleton")}let _=(()=>{class e extends R{constructor(){super(...arguments),this.width=0,this.height=200,this.padding=0,this.data=[],this.clickItem=new t.vpe}initTagCloud(){const n=this.winG2;n.registerShape("point","cloud",{draw(o,i){const a=o.data,l=i.addShape({type:"text",name:"tag-cloud-text",attrs:{...o.style,fontSize:a.size,text:a.text,textAlign:"center",fontFamily:a.font,fill:o.color,textBaseline:"Alphabetic",x:o.x,y:o.y}});return a.rotate&&n.Util.rotate(l,a.rotate*Math.PI/180),l}})}install(){this.initTagCloud();const{el:n,padding:o,theme:i}=this;0===this.height&&(this.height=this.el.nativeElement.clientHeight),0===this.width&&(this.width=this.el.nativeElement.clientWidth);const a=this._chart=new this.winG2.Chart({container:n.nativeElement,autoFit:!1,padding:o,height:this.height,width:this.width,theme:i});a.scale({x:{nice:!1},y:{nice:!1}}),a.legend(!1),a.axis(!1),a.tooltip({showTitle:!1,showMarkers:!1}),a.coordinate().reflect(),a.point().position("x*y").color("text").shape("cloud").state({active:{style:{fillOpacity:.4}}}),a.interaction("element-active"),a.on("tag-cloud-text:click",l=>{this.ngZone.run(()=>this.clickItem.emit({item:l.data?.data,ev:l}))}),this.ready.next(a),this.changeData(),a.render()}changeData(){const{_chart:n,data:o}=this;if(!n||!Array.isArray(o)||o.length<=0)return;const i=(new window.DataSet.View).source(o),a=i.range("value"),l=a[0],st=a[1];i.transform({type:"tag-cloud",fields:["name","value"],font:"Verdana",size:[this.width,this.height],padding:0,timeInterval:5e3,rotate(){let m=~~(4*Math.random())%4;return 2===m&&(m=0),90*m},fontSize:m=>(m.value-l)/(st-l)*24+8}),n.changeData(i.rows)}installResizeEvent(){this.resize$=(0,S.R)(window,"resize").pipe((0,C.h)(()=>!!this._chart),(0,F.b)(200)).subscribe(()=>this.changeData())}onInit(){this.installResizeEvent()}}return e.\u0275fac=function(){let s;return function(o){return(s||(s=t.n5z(e)))(o||e)}}(),e.\u0275cmp=t.Xpm({type:e,selectors:[["g2-tag-cloud"]],inputs:{width:"width",height:"height",padding:"padding",data:"data"},outputs:{clickItem:"clickItem"},exportAs:["g2TagCloud"],features:[t.qOj],decls:1,vars:1,consts:[[4,"ngIf"]],template:function(n,o){1&n&&t.YNc(0,B,1,0,"nz-skeleton",0),2&n&&t.Q6J("ngIf",!o.loaded)},dependencies:[h.O5,z.ng],encapsulation:2,changeDetection:0}),(0,c.gn)([(0,p.Rn)()],e.prototype,"width",void 0),(0,c.gn)([(0,p.Rn)()],e.prototype,"height",void 0),e})(),U=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[h.ez,z.H0]}),e})();var k=r(8418),Z=r(4788),u=r(6152),b=r(5156),g=r(6616),f=r(7044),y=r(1811),d=r(9094);function E(e,s){if(1&e&&t._UZ(0,"g2-tag-cloud",6),2&e){const n=t.oxw();t.Q6J("data",n.list)}}function j(e,s){1&e&&t._UZ(0,"nz-empty",7)}let A=(()=>{class e{constructor(n){this.modal=n,this.list=[]}close(){this.modal.destroy()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(b.Lf))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-tag-cloud"]],decls:10,vars:8,consts:[[1,"modal-header"],[1,"modal-title"],["height","400",3,"data",4,"ngIf"],["nzNotFoundImage","simple",4,"ngIf"],[1,"modal-footer"],["nz-button","","type","button",3,"click"],["height","400",3,"data"],["nzNotFoundImage","simple"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2),t.ALo(3,"i18n"),t.qZA()(),t.YNc(4,E,1,1,"g2-tag-cloud",2),t.YNc(5,j,1,0,"nz-empty",3),t.TgZ(6,"div",4)(7,"button",5),t.NdJ("click",function(){return o.close()}),t._uU(8),t.ALo(9,"i18n"),t.qZA()()),2&n&&(t.xp6(2),t.Oqu(t.lcZ(3,4,"app.tag.cloud")),t.xp6(2),t.Q6J("ngIf",o.list.length),t.xp6(1),t.Q6J("ngIf",!o.list.length),t.xp6(3),t.Oqu(t.lcZ(9,6,"app.form.close")))},dependencies:[h.O5,g.ix,f.w,y.dQ,_,Z.p9,d.Ck],encapsulation:2}),e})();var I=r(9651),O=r(9959);function P(e,s){1&e&&(t.TgZ(0,"div",7),t._uU(1),t.ALo(2,"i18n"),t.qZA()),2&e&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"app.tag.update"),""))}function H(e,s){1&e&&(t.TgZ(0,"div",7),t._uU(1),t.ALo(2,"i18n"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"app.tag.create")))}r(9553);let M=(()=>{class e{constructor(n,o,i,a,l){this.modal=n,this.msg=o,this.http=i,this.cdr=a,this.i18n=l,this.record={},this.schema={properties:{name:{type:"string",title:this.i18n.fanyi("app.tag.name")}},required:["name"]},this.ui={"*":{spanLabelFixed:100,grid:{span:24}}}}save(n){this.http.request(this.record&&this.record.id?"put":"post","/api/tags"+(this.record&&this.record.id?`/${this.record.id}`:""),{body:n}).subscribe(a=>{a.code||(this.msg.success(this.i18n.fanyi("app.form.save-success")),this.modal.close(!0))})}close(){this.modal.destroy()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(b.Lf),t.Y36(I.dD),t.Y36(d.lP),t.Y36(t.sBO),t.Y36(d.Oi))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-tag-form"]],decls:12,vars:14,consts:[[1,"modal-header"],["class","modal-title",4,"ngIf"],["mode","edit",3,"schema","ui","formData","button"],["sf",""],[1,"modal-footer"],["nz-button","","type","button",3,"click"],["nz-button","","type","submit","nzType","primary",3,"disabled","nzLoading","click"],[1,"modal-title"]],template:function(n,o){if(1&n){const i=t.EpF();t.TgZ(0,"div",0),t.YNc(1,P,3,3,"div",1),t.YNc(2,H,3,3,"div",1),t.qZA(),t.TgZ(3,"sf",2,3)(5,"div",4)(6,"button",5),t.NdJ("click",function(){return o.close()}),t._uU(7),t.ALo(8,"i18n"),t.qZA(),t.TgZ(9,"button",6),t.NdJ("click",function(){t.CHM(i);const l=t.MAs(4);return t.KtG(o.save(l.value))}),t._uU(10),t.ALo(11,"i18n"),t.qZA()()()}if(2&n){const i=t.MAs(4);t.xp6(1),t.Q6J("ngIf",null==o.record?null:o.record.id),t.xp6(1),t.Q6J("ngIf",!(null!=o.record&&o.record.id)),t.xp6(1),t.Q6J("schema",o.schema)("ui",o.ui)("formData",o.record)("button","none"),t.xp6(4),t.Oqu(t.lcZ(8,10,"app.form.close")),t.xp6(2),t.Q6J("disabled",!i.valid)("nzLoading",o.http.loading),t.xp6(1),t.hij(" ",t.lcZ(11,12,"app.form.save")," ")}},dependencies:[h.O5,O.kJ,g.ix,f.w,y.dQ,d.Ck],encapsulation:2}),e})();var G=r(3679),K=r(1971),W=r(6497),X=r(1102);function V(e,s){if(1&e){const n=t.EpF();t.TgZ(0,"a",11),t.NdJ("click",function(){t.CHM(n);const i=t.oxw().$implicit,a=t.oxw();return t.KtG(a.form(i))}),t._uU(1),t.qZA(),t.TgZ(2,"span",12),t._uU(3),t.ALo(4,"i18n"),t.qZA()}if(2&e){const n=t.oxw().$implicit;t.xp6(1),t.Oqu(n.name),t.xp6(2),t.AsE("(",n.value," ",t.lcZ(4,3,"app.tag.times"),")")}}function q(e,s){if(1&e){const n=t.EpF();t.TgZ(0,"span",13)(1,"i",14),t.NdJ("click",function(){t.CHM(n);const i=t.oxw().$implicit,a=t.oxw();return t.KtG(a.form(i))}),t.qZA()(),t.TgZ(2,"span",13)(3,"i",15),t.NdJ("nzOnConfirm",function(){t.CHM(n);const i=t.oxw().$implicit,a=t.oxw();return t.KtG(a.delete(i))}),t.ALo(4,"i18n"),t.qZA()()}2&e&&(t.xp6(3),t.Q6J("nz-popconfirm",t.lcZ(4,1,"app.delete.confirm")))}function tt(e,s){if(1&e&&(t.TgZ(0,"g2-card",8),t.YNc(1,V,5,5,"ng-template",null,9,t.W1O),t.YNc(3,q,5,3,"ng-template",null,10,t.W1O),t.qZA()),2&e){const n=s.$implicit,o=t.MAs(2),i=t.MAs(4);t.Q6J("title",o)("bordered",!0)("total",n.currency_balance_desc)("action",i)}}const et=function(){return{xs:6,sm:16,md:24,lg:32}},nt=function(){return{gutter:24,lg:8,md:12,sm:24,xs:24}};let w=(()=>{class e{constructor(n,o,i,a,l){this.http=n,this.msg=o,this.modal=i,this.cdr=a,this.i18n=l,this.url="/api/tags",this.loading=!0,this.list=[],this.q={all:1,name:""},this.searchSchema={properties:{name:{type:"string",title:this.i18n.fanyi("app.tag.name")}}}}ngOnInit(){this.index()}index(){this.loading=!0,this.http.get(`${this.url}`,this.q).subscribe(n=>{this.list=n.map(o=>({value:o.count,name:o.name,id:o.id})),this.loading=!1,this.cdr.detectChanges()})}form(n){this.modal.create(M,{record:n},{size:"md"}).subscribe(()=>{this.index()})}cloud(){this.modal.create(A,{list:this.list},{size:"md"}).subscribe(()=>{})}delete(n){this.http.delete(`/api/tags/${n.id}`).subscribe(o=>{o.code||this.msg.success(this.i18n.fanyi("app.delete.success")),this.index()})}submit(n){n.name&&(this.q.name=n.name,this.index())}reset(){this.q.name="",this.index()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(d.lP),t.Y36(I.dD),t.Y36(d.Te),t.Y36(t.sBO),t.Y36(d.Oi))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-tag-index"]],decls:15,vars:14,consts:[[1,"pt-md"],["nz-row","",3,"nzGutter"],["nz-col",""],["mode","search",3,"schema","formSubmit","formReset"],["nz-button","","nzType","primary",3,"click"],["nz-button","",3,"click"],[3,"nzDataSource","nzLoading","nzRenderItem","nzGrid"],["item",""],[3,"title","bordered","total","action"],["title",""],["action",""],[1,"text-md",3,"click"],[1,"text-sm","text-muted","pl-sm"],[1,"pl-sm"],["nz-icon","","nzType","edit",3,"click"],["nz-icon","","nzType","delete","nzPopconfirmPlacement","bottom",3,"nz-popconfirm","nzOnConfirm"]],template:function(n,o){if(1&n&&(t.TgZ(0,"div",0)(1,"nz-card")(2,"div",1)(3,"div",2)(4,"sf",3),t.NdJ("formSubmit",function(a){return o.submit(a)})("formReset",function(){return o.reset()}),t.qZA()(),t.TgZ(5,"div",2)(6,"button",4),t.NdJ("click",function(){return o.form()}),t._uU(7),t.ALo(8,"i18n"),t.qZA(),t.TgZ(9,"button",5),t.NdJ("click",function(){return o.cloud()}),t._uU(10),t.ALo(11,"i18n"),t.qZA()()()()(),t.TgZ(12,"nz-list",6),t.YNc(13,tt,5,4,"ng-template",null,7,t.W1O),t.qZA()),2&n){const i=t.MAs(14);t.xp6(2),t.Q6J("nzGutter",t.DdM(12,et)),t.xp6(2),t.Q6J("schema",o.searchSchema),t.xp6(3),t.Oqu(t.lcZ(8,8,"app.form.create")),t.xp6(3),t.Oqu(t.lcZ(11,10,"app.tag.cloud")),t.xp6(2),t.Q6J("nzDataSource",o.list)("nzLoading",o.loading)("nzRenderItem",i)("nzGrid",t.DdM(13,nt))}},dependencies:[O.kJ,G.t3,G.SK,g.ix,f.w,y.dQ,K.bd,W.JW,X.Ls,u.n_,u.fl,T.n,d.Ck],encapsulation:2}),e})();var D=r(9132);const ot=[{path:"index",component:w}];let it=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[D.Bz.forChild(ot),D.Bz]}),e})(),at=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[k.m8,it,U,Z.Xo,u.Ph,T.T]}),e})()}}]);