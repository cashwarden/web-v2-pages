"use strict";(self.webpackChunkcashwarden_web_ng=self.webpackChunkcashwarden_web_ng||[]).push([[432],{432:(pt,z,a)=>{a.r(z),a.d(z,{SettingsModule:()=>at});var J=a(8418),m=a(6152),p=a(9094),h=a(9646),t=a(4650),u=a(9651),y=a(9959),b=a(6616),_=a(7044),S=a(1811),f=a(9597);a(9553);let w=(()=>{class e{constructor(n,i,o,r,l,g){this.http=n,this.settings=i,this.titleSrv=o,this.msg=r,this.cdr=l,this.i18n=g,this.timezones=[],this.schema={properties:{},required:[]},this.ui={"*":{spanLabelFixed:120,grid:{span:24}}}}ngOnInit(){this.titleSrv.setTitle(this.i18n.fanyi("app.settings.personal.base"));const n=this.settings.user;this.timezones=this.settings.app.timezones,this.schema={properties:{name:{type:"string",minLength:3,default:n.name,ui:{i18n:"app.user.name",placeholder:this.i18n.fanyi("app.user.name")}},email:{type:"string",default:n.email,ui:{type:"email",i18n:"app.user.email",placeholder:this.i18n.fanyi("app.user.email"),validator:i=>i&&!/^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,20}$/.test(i)?(0,h.of)([{keyword:"email",message:this.i18n.fanyi("app.user.email-invalid")}]):(0,h.of)([])}},timezone:{type:"string",default:n.timezone,ui:{i18n:"app.user.timezone",widget:"select",asyncData:()=>(0,h.of)(this.timezones),placeholder:this.i18n.fanyi("app.user.timezone")}},base_currency_code:{type:"string",default:n.currency,readOnly:!0,ui:{i18n:"app.user.base_currency_code"}}},required:["name","email","timezone"]}}save(n){this.http.put("/api/users",n).subscribe(i=>{i.code||(this.settings.setUser(i),this.msg.success(this.i18n.fanyi("app.form.submit-success")))})}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(p.lP),t.Y36(p.gb),t.Y36(p.yD),t.Y36(u.dD),t.Y36(t.sBO),t.Y36(p.Oi))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-settings-base"]],decls:8,vars:10,consts:[["nzType","warning",3,"nzMessage"],[3,"schema","ui","button","formSubmit"],["sf",""],["nz-button","","nzType","primary",3,"disabled"]],template:function(n,i){if(1&n&&(t.TgZ(0,"p"),t._UZ(1,"nz-alert",0),t.ALo(2,"i18n"),t.qZA(),t.TgZ(3,"sf",1,2),t.NdJ("formSubmit",function(r){return i.save(r)}),t.TgZ(5,"button",3),t._uU(6),t.ALo(7,"i18n"),t.qZA()()),2&n){const o=t.MAs(4);t.xp6(1),t.Q6J("nzMessage",t.lcZ(2,6,"app.settings.personal.update_email.warn")),t.xp6(2),t.Q6J("schema",i.schema)("ui",i.ui)("button",null),t.xp6(2),t.Q6J("disabled",!o.valid),t.xp6(1),t.Oqu(t.lcZ(7,8,"app.form.submit"))}},dependencies:[y.kJ,b.ix,_.w,S.dQ,f.r,p.Ck],encapsulation:2,changeDetection:0}),e})();var Y=a(5156),v=a(6895),F=a(6497),N=a(1102);function Q(e,s){if(1&e){const n=t.EpF();t.TgZ(0,"a",11),t.NdJ("click",function(){t.CHM(n);const o=t.oxw(2).$implicit,r=t.oxw();return t.KtG(r.bind(o.provider))}),t._UZ(1,"i",12),t.qZA()}}function k(e,s){1&e&&(t.TgZ(0,"a",13),t._UZ(1,"i",12),t.qZA())}function D(e,s){if(1&e&&(t.YNc(0,Q,2,0,"a",9),t.YNc(1,k,2,0,"a",10)),2&e){const n=t.oxw().$implicit,i=t.oxw();t.Q6J("ngIf",!i.getProvider(n.provider)),t.xp6(1),t.Q6J("ngIf",i.getProvider(n.provider))}}function E(e,s){1&e&&(t.TgZ(0,"a",13),t._UZ(1,"i",15),t.qZA())}const C=function(e){return{provider:e}};function $(e,s){if(1&e){const n=t.EpF();t.TgZ(0,"a",16),t.NdJ("nzOnConfirm",function(){t.CHM(n);const o=t.oxw(2).$implicit,r=t.oxw();let l;return t.KtG(r.unbind(null==(l=r.getProvider(o.provider))?null:l.id))}),t.ALo(1,"i18n"),t._UZ(2,"i",15),t.qZA()}if(2&e){const n=t.oxw(2).$implicit;t.Q6J("nz-popconfirm",t.xi3(1,1,"app.settings.personal.binding.unbound.confirm",t.VKq(4,C,n.provider)))}}function U(e,s){if(1&e&&(t.YNc(0,E,2,0,"a",10),t.YNc(1,$,3,6,"a",14)),2&e){const n=t.oxw().$implicit,i=t.oxw();t.Q6J("ngIf",!i.getProvider(n.provider)),t.xp6(1),t.Q6J("ngIf",i.getProvider(n.provider))}}function I(e,s){if(1&e){const n=t.EpF();t.TgZ(0,"a",11),t.NdJ("click",function(){t.CHM(n);const o=t.oxw(2).$implicit,r=t.oxw();return t.KtG(r.bind(o.provider))}),t._uU(1),t.ALo(2,"i18n"),t.qZA()}if(2&e){const n=t.oxw(2).$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,"app.settings.personal.binding.title",t.VKq(4,C,n.name))," ")}}function L(e,s){if(1&e&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"i18n"),t.qZA()),2&e){const n=t.oxw(2).$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,"app.settings.personal.binding.title",t.VKq(4,C,n.name))," ")}}function R(e,s){if(1&e&&(t.YNc(0,I,3,6,"a",9),t.YNc(1,L,3,6,"span",17)),2&e){const n=t.oxw().$implicit,i=t.oxw();t.Q6J("ngIf",!i.getProvider(n.provider)),t.xp6(1),t.Q6J("ngIf",i.getProvider(n.provider))}}function W(e,s){if(1&e&&t._UZ(0,"i",18),2&e){const n=t.oxw().$implicit;t.Q6J("nzIconfont",n.icon)}}function q(e,s){1&e&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"i18n"),t.qZA()),2&e&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"app.settings.personal.binding.unbound")," "))}function j(e,s){if(1&e&&(t.TgZ(0,"a",20),t._uU(1),t.qZA()),2&e){const n=t.oxw(3).$implicit,i=t.oxw();let o,r;t.MGl("href","https://t.me/",null==(o=i.getProvider(n.provider))?null:o.username,"",t.LSH),t.xp6(1),t.hij(" @",null==(r=i.getProvider(n.provider))?null:r.username," ")}}function G(e,s){if(1&e&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&e){const n=t.oxw(3).$implicit,i=t.oxw();let o;t.xp6(1),t.hij(" @",null==(o=i.getProvider(n.provider))?null:o.username," ")}}function K(e,s){if(1&e&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"i18n"),t.YNc(3,j,2,2,"a",19),t.YNc(4,G,2,1,"span",17),t.qZA()),2&e){const n=t.oxw(2).$implicit,i=t.oxw();let o;t.xp6(1),t.hij(" ",t.lcZ(2,3,"app.settings.personal.binding.bound")," "),t.xp6(2),t.Q6J("ngIf","telegram"===n.provider),t.xp6(1),t.Q6J("ngIf","telegram"!==n.provider&&(null==(o=i.getProvider(n.provider))?null:o.username))}}function H(e,s){if(1&e&&(t.YNc(0,q,3,3,"div",17),t.YNc(1,K,5,5,"div",17)),2&e){const n=t.oxw().$implicit,i=t.oxw();t.Q6J("ngIf",!i.getProvider(n.provider)),t.xp6(1),t.Q6J("ngIf",i.getProvider(n.provider))}}const V=function(e,s){return[e,s]};function X(e,s){if(1&e&&(t.ynx(0),t.TgZ(1,"nz-list-item",2),t.YNc(2,D,2,2,"ng-template",null,3,t.W1O),t.YNc(4,U,2,2,"ng-template",null,4,t.W1O),t.TgZ(6,"nz-list-item-meta",5),t.YNc(7,R,2,2,"ng-template",null,6,t.W1O),t.YNc(9,W,1,1,"ng-template",null,7,t.W1O),t.YNc(11,H,2,2,"ng-template",null,8,t.W1O),t.qZA()(),t.BQk()),2&e){const n=t.MAs(3),i=t.MAs(5),o=t.MAs(8),r=t.MAs(10),l=t.MAs(12);t.xp6(1),t.Q6J("nzActions",t.WLB(4,V,n,i)),t.xp6(5),t.Q6J("nzTitle",o)("nzAvatar",r)("nzDescription",l)}}let T=(()=>{class e{constructor(n,i,o,r,l,g,x){this.http=n,this.msg=i,this.modal=o,this.cdr=r,this.titleSrv=l,this.settings=g,this.i18n=x,this.data=[],this.providers=[{name:"Telegram",provider:"telegram",icon:"icon-telegram"},{name:"Github",provider:"github",icon:"icon-github"},{name:"Google",provider:"google",icon:"icon-google"}]}ngOnInit(){this.titleSrv.setTitle(this.i18n.fanyi("app.settings.personal.binding.title")),this.index()}index(){this.http.get("/api/users/providers").subscribe(n=>{this.data=n,this.cdr.detectChanges()})}getProvider(n){return console.log(this.data.find(i=>i.provider===n)),this.data.find(i=>i.provider===n)}bind(n){if("telegram"===n){const i=this.settings.app.telegram_bot_name;this.http.post("/api/users/rest-token").subscribe(o=>{const r=`/bind/${o.token}`,l=this.i18n.fanyi("app.settings.personal.binding.telegram.desc");this.modal.info({nzWidth:"500px",nzTitle:this.i18n.fanyi("app.settings.personal.binding.telegram.title"),nzContent:`${l} <a href="https://t.me/${i}" target="_blank">@${i}</a> </br> <code>${r}</code>`,nzOnOk:()=>this.index()})})}}unbind(n){!n||this.http.delete(`/api/users/providers/${n}`).subscribe(i=>{i.code||(this.index(),this.msg.success(this.i18n.fanyi("app.form.delete.success")))})}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(p.lP),t.Y36(u.dD),t.Y36(Y.Sf),t.Y36(t.sBO),t.Y36(p.yD),t.Y36(p.gb),t.Y36(p.Oi))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-settings-binding"]],decls:2,vars:1,consts:[["nzItemLayout","horizontal"],[4,"ngFor","ngForOf"],[3,"nzActions"],["edit",""],["del",""],[3,"nzTitle","nzAvatar","nzDescription"],["nzTitle",""],["nzAvatar",""],["nzDescription",""],[3,"click",4,"ngIf"],["disabled","",4,"ngIf"],[3,"click"],["nz-icon","","nzType","edit","theme","outline"],["disabled",""],["nzPopconfirmPlacement","bottom",3,"nz-popconfirm","nzOnConfirm",4,"ngIf"],["nz-icon","","nzType","delete","theme","outline"],["nzPopconfirmPlacement","bottom",3,"nz-popconfirm","nzOnConfirm"],[4,"ngIf"],["nz-icon","",1,"icon-sm",3,"nzIconfont"],["target","_blank",3,"href",4,"ngIf"],["target","_blank",3,"href"]],template:function(n,i){1&n&&(t.TgZ(0,"nz-list",0),t.YNc(1,X,13,7,"ng-container",1),t.qZA()),2&n&&(t.xp6(1),t.Q6J("ngForOf",i.providers))},dependencies:[v.sg,v.O5,_.w,F.JW,N.Ls,m.n_,m.AA,m.yi,p.Ck],encapsulation:2,changeDetection:0}),e})();var tt=a(538),c=a(9132);let A=(()=>{class e{constructor(n,i,o,r,l,g){this.http=n,this.titleSrv=i,this.msg=o,this.router=r,this.tokenService=l,this.i18n=g,this.schema={properties:{current_password:{type:"string",minLength:6,ui:{i18n:"app.user.current_password",type:"password",placeholder:this.i18n.fanyi("app.user.current_password")}},password:{type:"string",minLength:6,ui:{i18n:"app.user.password",type:"password",placeholder:this.i18n.fanyi("app.user.password")}},password_confirmation:{type:"string",minLength:6,ui:{type:"password",i18n:"app.user.password_confirmation",placeholder:this.i18n.fanyi("app.user.password_confirmation"),validator:(x,dt,P)=>P.value&&x!==P.value.password?[{keyword:"required",message:this.i18n.fanyi("app.user.password-not-match")}]:[]}}},required:["current_password","password","password_confirmation"]},this.ui={"*":{spanLabelFixed:160,grid:{span:24}}}}ngOnInit(){this.titleSrv.setTitle(this.i18n.fanyi("app.settings.personal.password"))}save(n){this.http.put("/api/users/change-password",n).subscribe(i=>{i.code||(this.msg.success(this.i18n.fanyi("app.settings.personal.password.success")),this.tokenService.clear(),this.router.navigateByUrl(this.tokenService.login_url).then())})}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(p.lP),t.Y36(p.yD),t.Y36(u.dD),t.Y36(c.F0),t.Y36(tt.T),t.Y36(p.Oi))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-settings-password"]],decls:5,vars:5,consts:[["nzType","warning",3,"nzMessage"],[3,"schema","ui","formSubmit"],["sf",""]],template:function(n,i){1&n&&(t.TgZ(0,"p"),t._UZ(1,"nz-alert",0),t.ALo(2,"i18n"),t.qZA(),t.TgZ(3,"sf",1,2),t.NdJ("formSubmit",function(r){return i.save(r)}),t.qZA()),2&n&&(t.xp6(1),t.Q6J("nzMessage",t.lcZ(2,3,"app.settings.personal.password.warn")),t.xp6(2),t.Q6J("schema",i.schema)("ui",i.ui))},dependencies:[y.kJ,f.r,p.Ck],encapsulation:2,changeDetection:0}),e})();var nt=a(4968),et=a(8372),Z=a(3325);function it(e,s){if(1&e){const n=t.EpF();t.TgZ(0,"li",6),t.NdJ("click",function(){const r=t.CHM(n).$implicit,l=t.oxw();return t.KtG(l.to(r))}),t._uU(1),t.qZA()}if(2&e){const n=s.$implicit;t.Q6J("nzSelected",n.selected),t.xp6(1),t.Oqu(n.title)}}let M=(()=>{class e{constructor(n,i,o,r){this.router=n,this.cdr=i,this.el=o,this.i18n=r,this.mode="inline",this.menus=[{key:"base",title:this.i18n.fanyi("app.settings.personal.base")},{key:"password",title:this.i18n.fanyi("app.settings.personal.password")},{key:"binding",title:this.i18n.fanyi("app.settings.personal.binding")}],this.setActive()}setActive(){const n=this.router.url.substring(this.router.url.lastIndexOf("/")+1);this.menus.forEach(i=>{i.selected=i.key===n}),this.title=this.menus.find(i=>i.selected).title}to(n){this.router.navigateByUrl(`/settings/personal/${n.key}`).then()}resize(){const n=this.el.nativeElement;let i="inline";const{offsetWidth:o}=n;o<641&&o>400&&(i="horizontal"),window.innerWidth<768&&o>400&&(i="horizontal"),this.mode=i,this.cdr.detectChanges()}ngAfterViewInit(){this.resize$=(0,nt.R)(window,"resize").pipe((0,et.b)(200)).subscribe(()=>this.resize())}ngOnDestroy(){this.resize$.unsubscribe()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(c.F0),t.Y36(t.sBO),t.Y36(t.SBq),t.Y36(p.Oi))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-settings-personal"]],decls:8,vars:3,consts:[[1,"main","ant-card-bordered"],[1,"menu"],["nz-menu","",3,"nzMode"],["nz-menu-item","",3,"nzSelected","click",4,"ngFor","ngForOf"],[1,"content"],[1,"title"],["nz-menu-item","",3,"nzSelected","click"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"ul",2),t.YNc(3,it,2,2,"li",3),t.qZA()(),t.TgZ(4,"div",4)(5,"div",5),t._uU(6),t.qZA(),t._UZ(7,"router-outlet"),t.qZA()()),2&n&&(t.xp6(2),t.Q6J("nzMode",i.mode),t.xp6(1),t.Q6J("ngForOf",i.menus),t.xp6(3),t.Oqu(i.title))},dependencies:[v.sg,c.lC,_.w,Z.wO,Z.r9],styles:["[_nghost-%COMP%]{display:block;padding-top:24px}[_nghost-%COMP%]     .main{display:flex;width:100%;padding-top:16px;padding-bottom:16px;overflow:auto;background-color:#fff}[_nghost-%COMP%]     .menu{width:224px;border-right:1px solid #f0f0f0}[_nghost-%COMP%]     .menu .ant-menu-inline{border:none}[_nghost-%COMP%]     .menu .ant-menu:not(.ant-menu-horizontal) .ant-menu-item-selected{font-weight:700}[_nghost-%COMP%]     .content{flex:1;padding:8px 40px}[_nghost-%COMP%]     .content .title{margin-bottom:12px;color:#000000d9;font-weight:500;font-size:20px;line-height:28px}[_nghost-%COMP%]     .content .ant-list-split .ant-list-item:last-child{border-bottom:1px solid #e8e8e8}[_nghost-%COMP%]     .content .ant-list-item{padding-top:14px;padding-bottom:14px}@media screen and (max-width: 767px){[_nghost-%COMP%]     .main{flex-direction:column}[_nghost-%COMP%]     .main .menu{width:100%;border:none}[_nghost-%COMP%]     .main .content{padding:40px}}[data-theme=dark]   [_nghost-%COMP%]     .main{background-color:#141414}[data-theme=dark]   [_nghost-%COMP%]     .content .title{color:#ffffffa6}[data-theme=dark]   [_nghost-%COMP%]     .menu{border-right-color:#303030}[data-theme=dark]   [_nghost-%COMP%]     .content .ant-list-split .ant-list-item:last-child{border-bottom-color:#303030}"],changeDetection:0}),e})();var d=a(433),B=a(1098),ot=a(6704);const st=[{path:"personal",component:M,children:[{path:"",redirectTo:"base",pathMatch:"full"},{path:"base",component:w},{path:"binding",component:T},{path:"password",component:A},{path:"report",component:(()=>{class e{constructor(n,i,o,r){this.http=n,this.titleSrv=i,this.msg=o,this.cdr=r,this.url="/api/users/settings",this.form={daily_report:!1,weekly_report:!1,monthly_report:!1}}ngOnInit(){this.titleSrv.setTitle("\u8bbe\u7f6e\u62a5\u544a"),this.load()}save(n){this.http.post(this.url,{...n}).subscribe(i=>{0===i.code?(this.form=i.data,this.msg.success("\u66f4\u65b0\u6210\u529f")):this.msg.warning(i.message)})}load(){this.http.get(this.url).subscribe(n=>{0===n.code?(this.form=n.data,this.cdr.detectChanges()):this.msg.warning(n.message)})}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(p.lP),t.Y36(p.yD),t.Y36(u.dD),t.Y36(t.sBO))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-settings-report"]],decls:12,vars:4,consts:[["nzType","warning","nzMessage","\u6ce8\u610f\uff01\u6b64\u529f\u80fd\u53ea\u4e3a Pro \u5e76\u4e14\u5df2\u7ecf\u7ed1\u5b9a Telegram \u7684\u7528\u6237\u4f7f\u7528"],["nz-form","","se-container","1","labelWidth","100",1,"pt-lg",3,"ngSubmit"],["f","ngForm"],["label","\u65e5\u62a5","extra","\u6bcf\u5929\u65e9\u4e0a 10 \u70b9\u62a5\u544a\u6628\u65e5\u6d88\u8d39\u6c47\u603b"],["nzCheckedChildren","\u5f00","nzUnCheckedChildren","\u5173","name","daily_report",3,"ngModel","ngModelChange"],["label","\u5468\u62a5","extra","\u6bcf\u5468\u4e00\u65e9\u4e0a 10 \u70b9\u62a5\u544a\u4e0a\u5468\u6d88\u8d39\u6c47\u603b"],["nzCheckedChildren","\u5f00","nzUnCheckedChildren","\u5173","name","weekly_report",3,"ngModel","ngModelChange"],["label","\u6708\u62a5","extra","\u6bcf\u6708 1 \u53f7\u65e9\u4e0a 10 \u70b9\u62a5\u544a\u4e0a\u4e2a\u6708\u6d88\u8d39\u6c47\u603b"],["nzCheckedChildren","\u5f00","nzUnCheckedChildren","\u5173","name","monthly_report",3,"ngModel","ngModelChange"],["col","1"],["nz-button","","nzType","primary",3,"disabled"]],template:function(n,i){if(1&n&&(t._UZ(0,"nz-alert",0),t.TgZ(1,"form",1,2),t.NdJ("ngSubmit",function(){return i.save(i.form)}),t.TgZ(3,"se",3)(4,"nz-switch",4),t.NdJ("ngModelChange",function(r){return i.form.daily_report=r}),t.qZA()(),t.TgZ(5,"se",5)(6,"nz-switch",6),t.NdJ("ngModelChange",function(r){return i.form.weekly_report=r}),t.qZA()(),t.TgZ(7,"se",7)(8,"nz-switch",8),t.NdJ("ngModelChange",function(r){return i.form.monthly_report=r}),t.qZA()(),t.TgZ(9,"se",9)(10,"button",10),t._uU(11,"\u4fdd\u5b58"),t.qZA()()()),2&n){const o=t.MAs(2);t.xp6(4),t.Q6J("ngModel",i.form.daily_report),t.xp6(2),t.Q6J("ngModel",i.form.weekly_report),t.xp6(2),t.Q6J("ngModel",i.form.monthly_report),t.xp6(2),t.Q6J("disabled",o.invalid)}},dependencies:[d._Y,d.JJ,d.JL,d.On,d.F,B.nV,B.d_,ot.Lr,b.ix,_.w,S.dQ,f.r],encapsulation:2,changeDetection:0}),e})()}]}];let rt=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[c.Bz.forChild(st),c.Bz]}),e})(),at=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[J.m8,rt,m.Ph]}),e})()}}]);