"use strict";(self.webpackChunkcashwarden_web_ng=self.webpackChunkcashwarden_web_ng||[]).push([[98],{2548:(ae,_,s)=>{s.r(_),s.d(_,{RuleModule:()=>oe});var A=s(8418),d=s(8521),u=s(9094),e=s(4650),Q=s(5156),g=s(9651),h=s(9559),f=s(6895),c=s(433),z=s(1098),R=s(6704),C=s(6616),y=s(7044),Z=s(1811),M=s(5635),T=s(8231),L=s(1102);function N(t,l){1&t&&(e.TgZ(0,"div",25),e._uU(1),e.ALo(2,"i18n"),e.qZA()),2&t&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"app.rule.update"),""))}function O(t,l){1&t&&(e.TgZ(0,"div",25),e._uU(1),e.ALo(2,"i18n"),e.qZA()),2&t&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"app.rule.create")))}function Y(t,l){if(1&t&&(e.TgZ(0,"label",27),e._uU(1),e.qZA()),2&t){const n=e.oxw().$implicit;e.Q6J("nzValue",n.value),e.xp6(1),e.hij(" ",n.label," ")}}function D(t,l){if(1&t&&(e.ynx(0),e.YNc(1,Y,2,2,"label",26),e.BQk()),2&t){const n=l.$implicit;e.xp6(1),e.Q6J("ngIf","adjust"!=n.value)}}function S(t,l){if(1&t&&e._UZ(0,"nz-option",28),2&t){const n=l.$implicit;e.Q6J("nzLabel",n.label)("nzValue",n.value)}}function I(t,l){if(1&t&&(e.TgZ(0,"nz-option",31),e._UZ(1,"i",32),e._uU(2),e.qZA()),2&t){const n=l.$implicit;e.Q6J("nzLabel",n.label)("nzValue",n.value),e.xp6(1),e.MGl("nzIconfont","icon-",n.icon,""),e.xp6(1),e.hij(" ",n.label," ")}}function V(t,l){if(1&t){const n=e.EpF();e.TgZ(0,"se",10),e.ALo(1,"i18n"),e.TgZ(2,"nz-select",29),e.NdJ("ngModelChange",function(a){e.CHM(n);const i=e.oxw();return e.KtG(i.form.then_category_id=a)}),e.YNc(3,I,3,4,"nz-option",30),e.qZA()()}if(2&t){const n=e.oxw();e.Q6J("label",e.lcZ(1,3,"app.rule.then_category_id")),e.xp6(2),e.Q6J("ngModel",n.form.then_category_id),e.xp6(1),e.Q6J("ngForOf",n.selectData.category_id)}}function $(t,l){if(1&t&&(e.TgZ(0,"nz-option",31),e._UZ(1,"i",32),e._uU(2),e.qZA()),2&t){const n=l.$implicit;e.Q6J("nzLabel",n.label)("nzValue",n.value),e.xp6(1),e.MGl("nzIconfont","icon-",n.icon,""),e.xp6(1),e.hij(" ",n.label," ")}}function U(t,l){if(1&t){const n=e.EpF();e.TgZ(0,"se",10),e.ALo(1,"i18n"),e.TgZ(2,"nz-select",33),e.NdJ("ngModelChange",function(a){e.CHM(n);const i=e.oxw();return e.KtG(i.form.then_from_account_id=a)}),e.YNc(3,$,3,4,"nz-option",30),e.qZA()()}if(2&t){const n=e.oxw();e.Q6J("label",e.lcZ(1,3,"app.rule.then_from_account_id")),e.xp6(2),e.Q6J("ngModel",n.form.then_from_account_id),e.xp6(1),e.Q6J("ngForOf",n.selectData.account_id)}}function q(t,l){if(1&t&&(e.TgZ(0,"nz-option",31),e._UZ(1,"i",32),e._uU(2),e.qZA()),2&t){const n=l.$implicit;e.Q6J("nzLabel",n.label)("nzValue",n.value),e.xp6(1),e.MGl("nzIconfont","icon-",n.icon,""),e.xp6(1),e.hij(" ",n.label," ")}}function B(t,l){if(1&t){const n=e.EpF();e.TgZ(0,"se",10),e.ALo(1,"i18n"),e.TgZ(2,"nz-select",34),e.NdJ("ngModelChange",function(a){e.CHM(n);const i=e.oxw();return e.KtG(i.form.then_to_account_id=a)}),e.YNc(3,q,3,4,"nz-option",30),e.qZA()()}if(2&t){const n=e.oxw();e.Q6J("label",e.lcZ(1,3,"app.rule.then_to_account_id")),e.xp6(2),e.Q6J("ngModel",n.form.then_to_account_id),e.xp6(1),e.Q6J("ngForOf",n.selectData.account_id)}}function j(t,l){if(1&t&&e._UZ(0,"nz-option",28),2&t){const n=l.$implicit;e.Q6J("nzLabel",n)("nzValue",n)}}function w(t,l){if(1&t){const n=e.EpF();e.TgZ(0,"nz-select",35),e.NdJ("ngModelChange",function(a){e.CHM(n);const i=e.oxw();return e.KtG(i.form.then_currency_code=a)}),e.YNc(1,j,1,2,"nz-option",12),e.qZA()}if(2&t){const n=e.oxw();e.Q6J("ngModel",n.form.then_currency_code),e.xp6(1),e.Q6J("ngForOf",n.selectData.currencies)}}function G(t,l){if(1&t&&e._UZ(0,"nz-option",28),2&t){const n=l.$implicit;e.Q6J("nzLabel",n.value)("nzValue",n.value)}}function K(t,l){if(1&t&&(e.TgZ(0,"label",27),e._uU(1),e.qZA()),2&t){const n=l.$implicit;e.Q6J("nzValue",n.value),e.xp6(1),e.hij(" ",n.label," ")}}s(9553);const E=function(){return["transfer"]},H=function(){return["expense","transfer"]},P=function(){return["income","transfer"]};let b=(()=>{class t{constructor(n,o,a,i,p,m){this.http=n,this.modal=o,this.msgSrv=a,this.cdr=i,this.cache=p,this.i18n=m,this.record={},this.selectData={},this.form={name:"",if_keywords:[],then_transaction_type:"expense",then_ledger_id:"",then_reimbursement_status:"none",then_from_account_id:"",then_to_account_id:"",then_category_id:"",then_tags:[],then_currency_amount:"",then_currency_code:"",sort:99}}ngOnInit(){this.form=Object.assign(this.form,this.record),this.form.then_ledger_id&&this.changeCategory()}changeCategory(){!this.form.then_transaction_type||!this.form.then_ledger_id||this.http.get(`/api/ledgers/${this.form.then_ledger_id}/${this.form.then_transaction_type}/categories`).subscribe(n=>{0!==n.length?(this.selectData.category_id=n.map(o=>({value:o.id,label:o.name,icon:o?.icon_name})),this.form.then_category_id=this.record?this.form.then_transaction_type!==this.record.type?this.selectData.category_id[0].value:this.record.category_id:this.selectData.category_id[0]?.value):this.form.then_category_id=""})}save(n){this.http.request(this.record.id?"put":"post","/api/rules"+(this.record.id?`/${this.record.id}`:""),{body:n}).subscribe(i=>{i.code||(this.msgSrv.success(this.i18n.fanyi("app.form.save-success")),this.modal.close(i))})}close(){this.modal.destroy()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(u.lP),e.Y36(Q.Lf),e.Y36(g.dD),e.Y36(e.sBO),e.Y36(h.Q),e.Y36(u.Oi))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-rule-form"]],decls:48,vars:58,consts:[[1,"modal-header"],["class","modal-title",4,"ngIf"],["nz-form","","se-container","1.0",3,"ngSubmit"],["f","ngForm"],["required","",3,"label"],["nz-input","","name","name",3,"ngModel","ngModelChange"],["nzMode","tags","name","if_keywords",3,"ngModel","ngModelChange"],["required","",3,"label","title"],["nzButtonStyle","solid","name","type",3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],[3,"label"],["name","ledger_id","nzAllowClear","",3,"ngModel","ngModelChange"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],[3,"label",4,"ngIf"],[3,"nzAddOnAfter"],["nz-input","","type","number","name","then_currency_amount",3,"ngModel","ngModelChange"],["addOnAfterBtn",""],["nzMode","tags","name","then_tags",3,"ngModel","ngModelChange"],[3,"label","title"],["nzButtonStyle","solid","name","then_reimbursement_status",3,"ngModel","ngModelChange"],["nz-radio-button","",3,"nzValue",4,"ngFor","ngForOf"],["nz-input","","type","number","name","sort","required","",3,"ngModel","ngModelChange"],["col","1"],["nz-button","","type","button",3,"click"],["nz-button","","nzType","primary",3,"disabled"],[1,"modal-title"],["nz-radio-button","",3,"nzValue",4,"ngIf"],["nz-radio-button","",3,"nzValue"],[3,"nzLabel","nzValue"],["name","category_id",3,"ngModel","ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzCustomContent","",3,"nzLabel","nzValue"],["nz-icon","",3,"nzIconfont"],["name","from_account_id","nzAllowClear","",3,"ngModel","ngModelChange"],["name","to_account_id","nzAllowClear","",3,"ngModel","ngModelChange"],["name","then_currency_code",2,"width","80px",3,"ngModel","ngModelChange"]],template:function(n,o){if(1&n&&(e.TgZ(0,"div",0),e.YNc(1,N,3,3,"div",1),e.YNc(2,O,3,3,"div",1),e.qZA(),e.TgZ(3,"form",2,3),e.NdJ("ngSubmit",function(){return o.save(o.form)}),e.TgZ(5,"se",4),e.ALo(6,"i18n"),e.TgZ(7,"input",5),e.NdJ("ngModelChange",function(i){return o.form.name=i}),e.qZA()(),e.TgZ(8,"se",4),e.ALo(9,"i18n"),e.TgZ(10,"nz-select",6),e.NdJ("ngModelChange",function(i){return o.form.if_keywords=i}),e.qZA()(),e.TgZ(11,"se",7),e.ALo(12,"i18n"),e.ALo(13,"i18n"),e.TgZ(14,"nz-radio-group",8),e.NdJ("ngModelChange",function(i){return o.form.then_transaction_type=i})("ngModelChange",function(){return o.changeCategory()}),e.YNc(15,D,2,1,"ng-container",9),e.qZA()(),e.TgZ(16,"se",10),e.ALo(17,"i18n"),e.TgZ(18,"nz-select",11),e.NdJ("ngModelChange",function(i){return o.form.then_ledger_id=i})("ngModelChange",function(){return o.changeCategory()}),e.YNc(19,S,1,2,"nz-option",12),e.qZA()(),e.YNc(20,V,4,5,"se",13),e.YNc(21,U,4,5,"se",13),e.YNc(22,B,4,5,"se",13),e.TgZ(23,"se",10),e.ALo(24,"i18n"),e.TgZ(25,"nz-input-group",14)(26,"input",15),e.NdJ("ngModelChange",function(i){return o.form.then_currency_amount=i}),e.qZA(),e.YNc(27,w,2,2,"ng-template",null,16,e.W1O),e.qZA()(),e.TgZ(29,"se",10),e.ALo(30,"i18n"),e.TgZ(31,"nz-select",17),e.NdJ("ngModelChange",function(i){return o.form.then_tags=i}),e.YNc(32,G,1,2,"nz-option",12),e.qZA()(),e.TgZ(33,"se",18),e.ALo(34,"i18n"),e.ALo(35,"i18n"),e.TgZ(36,"nz-radio-group",19),e.NdJ("ngModelChange",function(i){return o.form.then_reimbursement_status=i}),e.YNc(37,K,2,2,"label",20),e.qZA()(),e.TgZ(38,"se",10),e.ALo(39,"i18n"),e.TgZ(40,"input",21),e.NdJ("ngModelChange",function(i){return o.form.sort=i}),e.qZA()(),e.TgZ(41,"se",22)(42,"button",23),e.NdJ("click",function(){return o.close()}),e._uU(43),e.ALo(44,"i18n"),e.qZA(),e.TgZ(45,"button",24),e._uU(46),e.ALo(47,"i18n"),e.qZA()()()),2&n){const a=e.MAs(4),i=e.MAs(28);e.xp6(1),e.Q6J("ngIf",o.record.id),e.xp6(1),e.Q6J("ngIf",!o.record.id),e.xp6(3),e.Q6J("label",e.lcZ(6,31,"app.rule.name")),e.xp6(2),e.Q6J("ngModel",o.form.name),e.xp6(1),e.Q6J("label",e.lcZ(9,33,"app.rule.if_keywords")),e.xp6(2),e.Q6J("ngModel",o.form.if_keywords),e.xp6(1),e.Q6J("label",e.lcZ(12,35,"app.rule.then_transaction_type"))("title",e.lcZ(13,37,"app.rule.then_transaction_type")),e.xp6(3),e.Q6J("ngModel",o.form.then_transaction_type),e.xp6(1),e.Q6J("ngForOf",o.selectData.transaction_type),e.xp6(1),e.Q6J("label",e.lcZ(17,39,"app.rule.then_ledger_id")),e.xp6(2),e.Q6J("ngModel",o.form.then_ledger_id),e.xp6(1),e.Q6J("ngForOf",o.selectData.ledger_id),e.xp6(1),e.Q6J("ngIf",o.form.then_ledger_id&&!e.DdM(55,E).includes(o.form.then_transaction_type)),e.xp6(1),e.Q6J("ngIf",e.DdM(56,H).includes(o.form.then_transaction_type)),e.xp6(1),e.Q6J("ngIf",e.DdM(57,P).includes(o.form.then_transaction_type)),e.xp6(1),e.Q6J("label",e.lcZ(24,41,"app.rule.then_currency_amount")),e.xp6(2),e.Q6J("nzAddOnAfter",i),e.xp6(1),e.Q6J("ngModel",o.form.then_currency_amount),e.xp6(3),e.Q6J("label",e.lcZ(30,43,"app.rule.then_tags")),e.xp6(2),e.Q6J("ngModel",o.form.then_tags),e.xp6(1),e.Q6J("ngForOf",o.selectData.tags),e.xp6(1),e.Q6J("label",e.lcZ(34,45,"app.rule.then_reimbursement_status"))("title",e.lcZ(35,47,"app.rule.then_reimbursement_status")),e.xp6(3),e.Q6J("ngModel",o.form.then_reimbursement_status),e.xp6(1),e.Q6J("ngForOf",o.selectData.reimbursement_status),e.xp6(1),e.Q6J("label",e.lcZ(39,49,"app.rule.sort")),e.xp6(2),e.Q6J("ngModel",o.form.sort),e.xp6(3),e.Oqu(e.lcZ(44,51,"app.form.close")),e.xp6(2),e.Q6J("disabled",a.invalid),e.xp6(1),e.Oqu(e.lcZ(47,53,"app.form.save"))}},dependencies:[f.sg,f.O5,c._Y,c.Fj,c.wV,c.JJ,c.JL,c.Q7,c.On,c.F,z.nV,z.d_,R.Lr,C.ix,y.w,Z.dQ,M.Zp,M.gB,T.Ip,T.Vq,L.Ls,d.Of,d.Bq,d.Dg,u.Ck],encapsulation:2}),t})();var x=s(8041),X=s(9959),W=s(1427),J=s(3679),k=s(1971);const ee=function(){return{xs:6,sm:16,md:24,lg:32}};let v=(()=>{class t{constructor(n,o,a,i,p,m){this.http=n,this.cdr=o,this.cache=a,this.msg=i,this.modal=p,this.i18n=m,this.loading=!0,this.list=[],this.selectData={},this.q={page:1,expand:"thenCategory,thenLedger",page_size:100,name:""},this.url="/api/rules",this.searchSchema={properties:{name:{type:"string",title:this.i18n.fanyi("app.rule.name")}}},this.columns=[{title:this.i18n.fanyi("app.rule.name"),index:"name"},{title:this.i18n.fanyi("app.rule.if_keywords"),index:"if_keywords"},{title:this.i18n.fanyi("app.rule.then_transaction_type"),index:"then_transaction_type_desc"},{title:this.i18n.fanyi("app.rule.then_ledger_id"),index:"thenLedger.name"},{title:this.i18n.fanyi("app.rule.then_category_id"),index:"thenCategory.name"},{title:this.i18n.fanyi("app.rule.sort"),index:"sort"},{title:this.i18n.fanyi("app.rule.status"),type:"badge",index:"status",badge:{true:{text:this.i18n.fanyi("app.status.active"),color:"success"},false:{text:this.i18n.fanyi("app.status.inactive"),color:"default"}}},{title:"",buttons:[{icon:"edit",type:"modal",click:r=>this.form(r)},{icon:"copy",type:"modal",click:r=>this.copy(r)},{icon:"play-circle",click:r=>this.updateStatus(r,!0),iif:r=>!1===r.status,tooltip:this.i18n.fanyi("app.status.active")},{icon:"pause-circle",click:r=>this.updateStatus(r,!1),iif:r=>!0===r.status,tooltip:this.i18n.fanyi("app.status.inactive")},{icon:"delete",type:"del",pop:{title:this.i18n.fanyi("app.delete.confirm"),okType:"danger"},click:(r,re,ie)=>{this.delete(r),ie.removeRow(r)}}]}]}ngOnInit(){this.index(),this.loadSelect("/api/accounts?all=1","account_id"),this.loadSelect("","exclude_from_stats"),this.loadSelect("/api/ledgers?all=1","ledger_id"),this.loadSelect("/api/ledgers/categories","ledger_category_id"),this.loadSelect("/api/transactions/types","transaction_type"),this.loadSelect("/api/users/currencies","currencies"),this.loadSelect("/api/transactions/reimbursement-statuses","reimbursement_status")}index(){this.loading=!0,this.http.get(this.url,this.q).subscribe(n=>{this.list=n.items,this.pagination=n.pagination,this.loading=!1})}form(n={}){this.modal.create(b,{record:n,selectData:this.selectData},{size:"md"}).subscribe(o=>{this.index(),this.cdr.detectChanges()})}copy(n){n.id=0,n.name=`${n.name} copy`,this.form(n)}delete(n){this.http.delete(`${this.url}/${n.id}`).subscribe(o=>{o.code||this.msg.success(this.i18n.fanyi("app.delete.success")),this.index()})}updateStatus(n,o){this.http.put(`${this.url}/${n.id}/status`,{status:o}).subscribe(a=>{a.code||this.msg.success(this.i18n.fanyi("app.update.success")),this.index()})}loadSelect(n,o){if(this.loading=!0,"exclude_from_stats"==o)return this.selectData[o]=[{value:!0,label:this.i18n.fanyi("app.status.active")},{value:!1,label:this.i18n.fanyi("app.status.inactive")}],this.loading=!1,void this.cache.set(x.f.cacheKey.selectCacheKey,this.selectData);this.http.get(n).subscribe(a=>{a&&(this.selectData[o]=["account_id","category_id","ledger_id"].includes(o)?a.map(i=>({value:i.id,label:i.name,icon:i?.icon_name?i.icon_name:i?.type})):a,this.loading=!1,this.cache.set(x.f.cacheKey.selectCacheKey,this.selectData),this.cdr.detectChanges())})}submit(n){this.q.name=n.name||"",this.index()}reset(){this.q.name="",this.index()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(u.lP),e.Y36(e.sBO),e.Y36(h.Q),e.Y36(g.dD),e.Y36(u.Te),e.Y36(u.Oi))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-rule-index"]],decls:13,vars:8,consts:[[1,"pt-lg"],["nz-row","",3,"nzGutter"],["nz-col",""],["mode","search",3,"schema","formSubmit","formReset"],["nz-button","","nzType","primary",3,"click"],[3,"data","columns"],["st",""]],template:function(n,o){1&n&&(e.TgZ(0,"div",0)(1,"nz-card")(2,"div",1)(3,"div",2)(4,"sf",3),e.NdJ("formSubmit",function(i){return o.submit(i)})("formReset",function(){return o.reset()}),e.qZA()(),e.TgZ(5,"div",2)(6,"button",4),e.NdJ("click",function(){return o.form()}),e.TgZ(7,"span"),e._uU(8),e.ALo(9,"i18n"),e.qZA()()()()()(),e.TgZ(10,"nz-card"),e._UZ(11,"st",5,6),e.qZA()),2&n&&(e.xp6(2),e.Q6J("nzGutter",e.DdM(7,ee)),e.xp6(2),e.Q6J("schema",o.searchSchema),e.xp6(4),e.Oqu(e.lcZ(9,5,"app.form.create")),e.xp6(3),e.Q6J("data",o.list)("columns",o.columns))},dependencies:[X.kJ,W.A5,J.t3,J.SK,C.ix,y.w,Z.dQ,k.bd,u.Ck],encapsulation:2}),t})();var F=s(9132);const ne=[{path:"index",component:v}];let te=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[F.Bz.forChild(ne),F.Bz]}),t})(),oe=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[A.m8,te,d.aF]}),t})()}}]);