"use strict";(self.webpackChunkcashwarden_web_ng=self.webpackChunkcashwarden_web_ng||[]).push([[530],{1530:(Zt,A,s)=>{s.r(A),s.d(A,{AnalysisModule:()=>vt}),s(655);var t=s(4650),u=(s(4968),s(3085),s(9300),s(8372),s(7883),s(174),s(6895)),v=s(6287),C=s(545);let H=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[u.ez,v.T,C.H0]}),n})();var b=s(2577);let nt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[u.ez,b.S,v.T,C.H0]}),n})();var m=s(8418),Z=s(6152),M=s(866),J=s(9132),_=s(9094),D=s(9903),B=s(135);let O=(()=>{class n{constructor(e,i){this.http=e,this.cdr=i,this.list=[],this.pagination={total:0,per_page:10,current_page:1,last_page:1},this.loading=!0,this.q={}}ngOnInit(){this.getData()}getData(){this.loading=!0,this.http.get("/api/records",(0,m.HO)(this.q)).subscribe(e=>{this.list=e.items,this.pagination=e.pagination,this.loading=!1,this.cdr.detectChanges()})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(_.lP),t.Y36(t.sBO))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-analysis-view"]],decls:6,vars:5,consts:[[1,"modal-header"],[1,"modal-title"],[3,"nzLoading"],[3,"items"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2),t.ALo(3,"i18n"),t.qZA()(),t.TgZ(4,"nz-list",2),t._UZ(5,"record-list",3),t.qZA()),2&e&&(t.xp6(2),t.hij(" ",t.lcZ(3,3,"app.analysis.category-records"),""),t.xp6(2),t.Q6J("nzLoading",i.loading),t.xp6(1),t.Q6J("items",i.list))},dependencies:[B.Z,Z.n_,_.Ck],encapsulation:2}),n})();var it=s(9651),Q=s(1427),F=s(3679),G=s(1971),L=s(6675),k=s(7830),ot=s(5788);function at(n,o){if(1&n&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.name)}}function st(n,o){if(1&n&&(t.TgZ(0,"div",19),t._uU(1),t.ALo(2,"i18n"),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.AsE(" ",t.lcZ(2,2,"app.analysis.amount"),"(",e.data.currency,") ")}}function rt(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"a",20),t.NdJ("click",function(){const r=t.CHM(e).$implicit,c=t.oxw().$implicit,l=t.oxw();return t.KtG(l.open(r.category_id,c.type))}),t._uU(1),t.qZA()}if(2&n){const e=o.$implicit;t.xp6(1),t.Oqu(e.category_name)}}function lt(n,o){if(1&n&&(t.TgZ(0,"tr")(1,"td")(2,"strong"),t._uU(3),t.ALo(4,"i18n"),t.qZA()(),t.TgZ(5,"td",19)(6,"strong"),t._uU(7),t.qZA()()()),2&n){const e=t.oxw(3);t.xp6(3),t.hij(" ",t.lcZ(4,2,"app.analysis.surplus"),""),t.xp6(4),t.Oqu(e.data.surplus)}}function ct(n,o){if(1&n&&(t.TgZ(0,"tr")(1,"td")(2,"strong"),t._uU(3),t.ALo(4,"i18n"),t.qZA()(),t.TgZ(5,"td",19)(6,"strong"),t._uU(7),t.qZA()()(),t.YNc(8,lt,8,4,"tr",9)),2&n){const e=t.oxw().$implicit;t.xp6(3),t.hij(" ",t.lcZ(4,3,"app.analysis.total"),""),t.xp6(4),t.Oqu(e.total),t.xp6(1),t.Q6J("ngIf","refund"===e.type)}}function dt(n,o){}s(9553);const gt=function(){return{show:!1}};function pt(n,o){if(1&n&&(t.ynx(0),t.TgZ(1,"st",12,13),t.YNc(3,at,2,1,"ng-template",14),t.YNc(4,st,3,4,"ng-template",15),t.YNc(5,rt,2,1,"ng-template",16),t.YNc(6,ct,9,5,"ng-template",null,17,t.W1O),t.YNc(8,dt,0,0,"ng-template",null,18,t.W1O),t.qZA(),t.BQk()),2&n){const e=o.$implicit,i=t.MAs(7),a=t.MAs(9),r=t.oxw();t.xp6(1),t.Q6J("data",e.items)("noResult",a)("loading",r.loading)("columns",r.columns)("page",t.DdM(6,gt))("body",i)}}function ht(n,o){if(1&n&&(t.ynx(0),t._UZ(1,"div",21),t.BQk()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("options",e.categoryChartData)}}function ut(n,o){if(1&n&&(t.ynx(0,26),t.TgZ(1,"div",27),t._uU(2),t.qZA(),t._UZ(3,"div",21),t.BQk()),2&n){const e=o.$implicit;t.xp6(2),t.hij(" ",e.title," "),t.xp6(1),t.Q6J("options",e.data)}}function mt(n,o){if(1&n&&(t.ynx(0),t.YNc(1,ut,4,2,"ng-container",25),t.BQk()),2&n){const e=t.oxw(3);t.xp6(1),t.Q6J("ngForOf",e.recordSumData)}}function _t(n,o){if(1&n&&(t.TgZ(0,"nz-tab",24),t.YNc(1,mt,2,1,"ng-container",9),t.qZA()),2&n){const e=o.$implicit,i=t.oxw(2);t.Q6J("nzTitle",e.name),t.xp6(1),t.Q6J("ngIf",!i.loadingSum)}}function ft(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"nz-tabset",22),t.NdJ("nzSelectedIndexChange",function(a){t.CHM(e);const r=t.oxw();return t.KtG(r.changeTab(a))}),t.YNc(1,_t,2,2,"nz-tab",23),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.tabs)}}const xt=[{path:"index",component:(()=>{class n{constructor(e,i,a,r,c){this.http=e,this.msg=i,this.modal=a,this.cdr=r,this.i18n=c,this.url="/api/analysis",this.q={},this.data={surplus:0,currency:"",categories:[]},this.date=[],this.loading=!0,this.loadingChart=!0,this.loadingSum=!0,this.maxRecords=[],this.columns=[{renderTitle:"customTitle",render:"custom"},{renderTitle:"customAmount",type:"currency",index:"amount"}],this.tabs=[{key:"day",name:this.i18n.fanyi("app.analysis.day-chart"),show:!0},{key:"month",name:this.i18n.fanyi("app.analysis.month-chart")},{key:"year",name:this.i18n.fanyi("app.analysis.year-chart")}]}ngOnInit(){this.date=(0,D.wb)("month"),this.date&&(this.q.date=this.date.map(e=>D.lI.format(e,"yyyy-MM-dd")).join("~")),this.index(),this.getMaxRecords(),this.getCategoryChartData(),this.getRecordSumData()}index(){this.loading=!0,this.http.get(`${this.url}/category`,(0,m.HO)(this.q)).subscribe(e=>{this.data=e,this.loading=!1,this.cdr.detectChanges()})}getRecordSumData(){this.loadingSum=!0,this.http.get(`${this.url}/date`,(0,m.HO)(this.q)).subscribe(e=>{this.recordSumData=e,this.loadingSum=!1,this.cdr.detectChanges()})}reloadData(e){e&&(this.q=e,this.index(),this.getCategoryChartData(),this.getMaxRecords())}reset(){this.q={date:this.date},this.index(),this.getCategoryChartData(),this.getMaxRecords()}getMaxRecords(){let e={reimbursement_status:"none,todo",expand:"transaction,account,category,ledger",exclude_from_stats:"false"};e={...e,...this.q,page_size:5,sort:"-amount_cent"},this.http.get("/api/records",(0,m.HO)(e)).subscribe(i=>{this.maxRecords=i.items,this.loading=!1,this.cdr.detectChanges()})}changeTab(e){this.tabs[e].show=!0,this.q.group_type=this.tabs[e].key,this.getRecordSumData(),this.cdr.detectChanges()}open(e,i){let a={reimbursement_status:"none,todo",expand:"transaction,account,category,ledger",page_size:100,exclude_from_stats:"false"};a={...a,...this.q,category_id:e,transaction_type:i},console.log(a),this.modal.create(O,{q:a},{size:"md"}).subscribe(r=>{})}getCategoryChartData(){this.loadingChart=!0,this.http.get("/api/analysis/category-chart",(0,m.HO)(this.q)).subscribe(e=>{this.categoryChartData=e,this.loadingChart=!1})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(_.lP),t.Y36(it.dD),t.Y36(_.Te),t.Y36(t.sBO),t.Y36(_.Oi))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-analysis-index"]],decls:19,vars:24,consts:[[1,"pt-md"],[3,"nzBordered"],[3,"date","searched","rested"],["nz-row","",3,"nzGutter"],["nz-col","","nzXs","24","nzSm","24","nzMd","24","nzLg","8"],[3,"nzLoading","nzBordered","nzTitle"],[4,"ngFor","ngForOf"],[3,"items"],["nz-col","","nzXs","24","nzSm","24","nzMd","24","nzLg","16"],[4,"ngIf"],[3,"nzLoading","nzBordered"],[3,"nzSelectedIndexChange",4,"ngIf"],["size","middle",3,"data","noResult","loading","columns","page","body"],["st",""],["st-row","customTitle","type","title"],["st-row","customAmount","type","title"],["st-row","custom"],["body",""],["noResult",""],[1,"text-right"],[3,"click"],["starkG2plotColumn","",3,"options"],[3,"nzSelectedIndexChange"],[3,"nzTitle",4,"ngFor","ngForOf"],[3,"nzTitle"],["class","ml-md",4,"ngFor","ngForOf"],[1,"ml-md"],[1,"pb-md","text-md"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"nz-card",1)(2,"record-search",2),t.NdJ("searched",function(r){return i.reloadData(r)})("rested",function(){return i.reset()}),t.qZA()()(),t.TgZ(3,"div",3)(4,"div",4)(5,"nz-card",5),t.ALo(6,"i18n"),t.YNc(7,pt,10,7,"ng-container",6),t.qZA(),t.TgZ(8,"nz-card",5),t.ALo(9,"i18n"),t.TgZ(10,"nz-list"),t._UZ(11,"record-list",7),t.qZA()()(),t.TgZ(12,"div",8)(13,"nz-card",5),t.ALo(14,"i18n"),t.YNc(15,ht,2,1,"ng-container",9),t.qZA(),t.TgZ(16,"nz-card",10)(17,"nz-card-tab"),t.YNc(18,ft,2,1,"nz-tabset",11),t.qZA()()()()),2&e&&(t.xp6(1),t.Q6J("nzBordered",!1),t.xp6(1),t.Q6J("date",i.date),t.xp6(1),t.Q6J("nzGutter",24),t.xp6(2),t.Q6J("nzLoading",i.loading)("nzBordered",!1)("nzTitle",t.lcZ(6,18,"app.analysis.category-statistics")),t.xp6(2),t.Q6J("ngForOf",i.data.categories),t.xp6(1),t.Q6J("nzLoading",i.loading)("nzBordered",!1)("nzTitle",t.lcZ(9,20,"app.analysis.maximum-5-expense-records")),t.xp6(3),t.Q6J("items",i.maxRecords),t.xp6(2),t.Q6J("nzLoading",i.loadingChart)("nzBordered",!1)("nzTitle",t.lcZ(14,22,"app.analysis.category-chart")),t.xp6(2),t.Q6J("ngIf",!i.loadingChart),t.xp6(1),t.Q6J("nzLoading",i.loadingSum)("nzBordered",!1),t.xp6(2),t.Q6J("ngIf",i.recordSumData))},dependencies:[u.sg,u.O5,Q.A5,Q.wZ,F.t3,F.SK,G.bd,G._i,L.Uo,L.$Z,k.xH,k.xw,ot.C,B.Z,Z.n_,M.t_,_.Ck],encapsulation:2}),n})()}];let yt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[J.Bz.forChild(xt),J.Bz]}),n})(),vt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[m.m8,yt,Z.Ph,nt,H,M.pj]}),n})()}}]);